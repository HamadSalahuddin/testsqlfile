/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:26 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [AgencyGetAllDetails]
(@AgencyID int=-1, @RoleID int=-1, @UserID int=-1)
--WITH 
--EXECUTE AS CALLER
AS
IF @RoleID = 2 or @RoleID = 15 
	BEGIN
		SELECT	AgencyID, Agency, t.Name as TimeZoneName, t.UtcOffset, t.DaylightUtcOffset
		FROM	Agency a(NOLOCK)
		INNER JOIN TimeZone t ON t.TimeZoneID = a.TimeZoneID
	 WHERE	a.deleted = 0 and
		AgencyID = @AgencyID
		ORDER BY Agency
	END
ELSE IF @RoleID = 8 or @RoleID = 4
	BEGIN
		SELECT	AgencyID, Agency, t.Name as TimeZoneName, t.UtcOffset, t.DaylightUtcOffset
		FROM	Agency a(NOLOCK)
		INNER JOIN TimeZone t ON t.TimeZoneID = a.TimeZoneID
	 WHERE	a.deleted = 0
		ORDER BY Agency
	END
ELSE IF @RoleID = 6 OR @RoleID = 20
	BEGIN
	SELECT	AgencyID, Agency, t.Name as TimeZoneName, t.UtcOffset, t.DaylightUtcOffset
		FROM	Agency a(NOLOCK)
		INNER JOIN TimeZone t ON t.TimeZoneID = a.TimeZoneID
		inner join distributoremployee de on a.DistributorID=de.DistributorID and de.UserID=@UserID
		 WHERE	a.deleted = 0
		ORDER BY Agency
	END
ELSE IF @RoleID = 19
	BEGIN
	SELECT	AgencyID, Agency, t.Name as TimeZoneName, t.UtcOffset, t.DaylightUtcOffset
		FROM	Agency a(NOLOCK)
		INNER JOIN TimeZone t ON t.TimeZoneID = a.TimeZoneID
		inner join distributor d on d.DistributorID= a.DistributorID and d.TamID=@UserID 
WHERE	a.deleted = 0
		ORDER BY Agency
	END
ELSE
	BEGIN
	SELECT	AgencyID, Agency, t.Name as TimeZoneName, t.UtcOffset, t.DaylightUtcOffset
		FROM	Agency a(NOLOCK)
		INNER JOIN TimeZone t ON t.TimeZoneID = a.TimeZoneID
WHERE	a.deleted = 0
		ORDER BY Agency
	END

GO
GRANT EXECUTE ON [AgencyGetAllDetails] TO [db_dml]
GO
