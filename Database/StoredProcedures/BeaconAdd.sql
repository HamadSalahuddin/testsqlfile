/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [BeaconAdd]  
 @ID              INT OUTPUT,   
 @Identifier         NVARCHAR(50),  
    @BeaconName         NVARCHAR(50),  
 @Street1            NVARCHAR(50),  
 @Street2            NVARCHAR(50),  
 @City               NVARCHAR(50),  
 @StateID         INT,  
 @Latitude           FLOAT,  
 @Longitude          FLOAT,  
 @ZipCode            NVARCHAR(25),  
 @OffenderID         INT,  
 @BeaconThresholdID  INT,  
 @AgencyID           int  
   
  
  
AS  
DECLARE @AddressID INT  
declare @iThresholdID int 
BEGIN  
    INSERT INTO Address  
 (Street1,Street2,ZipCode,City,StateID)  
 VALUES  
 (@Street1,@Street2,@ZipCode,@City,@StateID)  
  
 SET @AddressID = @@IDENTITY  
  
  
    INSERT INTO dbo.GPSLocation  
 (Longitude,Latitude,AddressID)  
 VALUES  
 (@Longitude,@Latitude,@AddressID)  
  
 INSERT INTO dbo.Beacon  
 (Identifier,BeaconName,AddressID,AgencyID)  
 VALUES  
 (@Identifier,@BeaconName,@AddressID,@AgencyID)  
  
 SET @ID = @@IDENTITY  
    
INSERT INTO dbo.BeaconOffender values(@ID,@OffenderID  )  


set @iThresholdID=0
SELECT @iThresholdID= BeaconThresholdID
from dbo.OffenderBeaconThreshold    
where offenderID= @OffenderID

if(@iThresholdID=0)
begin
INSERT INTO dbo.OffenderBeaconThreshold    
 (OffenderID,BeaconThresholdID)    
 VALUES    
 (@OffenderID,@BeaconThresholdID)     
end
else
begin	
UPDATE dbo.OffenderBeaconThreshold    
 SET BeaconThresholdID=@BeaconThresholdID   
 WHERE OffenderID=@OffenderID


 
end
END  
GO
GRANT EXECUTE ON [BeaconAdd] TO [db_dml]
GO
