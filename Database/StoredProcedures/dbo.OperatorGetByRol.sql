/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OperatorGetByRol]
	
	@RoleID		INT
AS
BEGIN
	SELECT	o.OperatorID, ISNULL(o.LastName, '')   + ', ' +  ISNULL(o.FirstName, '') AS 'OperatorName', r.[Role],u.[UserName] + '/' + ISNULL (CONVERT (NVARCHAR,u.UserID), '') AS UserName
				FROM	Operator o
				LEFT JOIN [User] u ON o.UserID = u.UserID
				LEFT JOIN User_Role ur ON u.UserID = ur.UserID
				LEFT JOIN [Role] r ON ur.RoleID = r.RoleID
				WHERE	
				
				(
					(@RoleID =0)
					OR
					(ur.RoleID = @RoleID)
				)	
				and
				o.Deleted = 0
				ORDER BY r.[Role], o.LastName, o.FirstName
END

GO
GRANT EXECUTE ON [OperatorGetByRol] TO [db_dml]
GO
