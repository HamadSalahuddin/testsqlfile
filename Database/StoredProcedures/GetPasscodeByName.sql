/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [GetPasscodeByName]
@FirstName nvarchar(100),
@LastName nvarchar(100)
AS
BEGIN
	SELECT  RTRIM(LastName) as 'LastName', RTRIM(FirstName) as 'FirstName', RTRIM(UserPassCode) as 'PassCode',
	r.role ,'' as agency,d.distributorName as 'Distributor'
	FROM DistributorEmployee DE join [User] U on DE.UserID = U.UserID
	join user_role ur on u.userid= ur.userid
	join [role] r on r.roleid= ur.roleid
	join distributor d on de.distributorid= d.distributorid
	WHERE  (
			(LEN(@LastName) <= 0) OR (DE.LastName  LIKE '%' + @LastName + '%')
		    ) AND (
			(LEN(@FirstName) <= 0) OR (DE.FirstName  LIKE '%' + @FirstName + '%')
			) AND (DE.Deleted = 0)
	UNION
	SELECT  RTRIM(LastName) as 'LastName', RTRIM(FirstName) as 'FirstName', RTRIM(UserPassCode) as 'PassCode'
	,r.role , a.agency,'' as 'Distributor'
	FROM Officer o JOIN [User] U on o.UserID = U.UserID
	join agency a on o.agencyid= a.agencyid
	join user_role ur on u.userid= ur.userid
	join [role] r on r.roleid= ur.roleid
	WHERE ((LEN(@LastName) <= 0) OR	(o.LastName  LIKE '%' + @LastName + '%')
			) AND (
			(LEN(@FirstName) <= 0) OR (o.FirstName  LIKE '%' + @FirstName + '%')
			) AND (o.Deleted = 0)
END
GO
GRANT EXECUTE ON [GetPasscodeByName] TO [db_dml]
GO
