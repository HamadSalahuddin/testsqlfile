/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:28 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [StaticGetAlarmForEvent]

@TrackerID	bigint,
@EventTime bigint,
@EventyTypeID int

AS

BEGIN

	SET NOCOUNT ON;

	SELECT 
		a.AlarmID,a.OffenderID,a.TrackerID,a.EventTypeID,a.EventTime,a.EventDisplayTime,a.AlarmTypeID,
		a.Latitude,a.Longitude,a.EventParameter,
		(
		CASE
			WHEN et.EventTypeGroupID =5
			THEN gr.GeoRuleName 
			ELSE 'N/A'
		END
		) AS 'GeoRule'
	FROM 
		Alarm a LEFT JOIN GeoRule gr ON gr.GeoRuleID = a.EventParameter
		LEFT JOIN EventType et ON a.EventTypeID = et.EventTypeID
    WHERE a.TrackerID=@TrackerID AND
		a.EventTime=@EventTime AND
		a.EventTypeID=@EventyTypeID
END
GO
GRANT VIEW DEFINITION ON [StaticGetAlarmForEvent] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [StaticGetAlarmForEvent] TO [db_dml]
GO
