/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
-- =============================================  
-- Author:  <Sajid Abbasi>  
-- Create date: <25-Nov-2009>  
-- Description: <This stored procedure is a wraper on GeoRuleUpdateStatus stored procedure  
-- It updates Status ID to Failed=5 if upload process fails.
-- =============================================  

CREATE PROCEDURE [GeoRule_SAVersionUpdateStatus]  
@geoRulesID Varchar(MAX), @StatusID int   
  
AS  
BEGIN  
 -- SET NOCOUNT ON added to prevent extra result sets from  
 -- interfering with SELECT statements.  
 SET NOCOUNT ON;  
-- SABBASI  
DECLARE @id int  
DECLARE MyCursor cursor fast_forward   
For  
SELECT number from GetTableFromListId( @geoRulesID )  
  
Begin TRAN   
Open MyCursor  
Fetch next From MyCursor  
INTO @id  
   
WHILE @@fetch_status = 0 AND @id > 0  
Begin  
  -- Perform Operations  
  Exec GeoRuleUpdateStatus @id, @StatusID  
    
  -- Advance the Cursor  
  Fetch next From MyCursor  
  INTO @id  
End  
   
Close MyCursor  
DEALLOCATE MyCursor  
IF @@ERROR <> 0  
BEGIN  
ROLLBACK Tran  
END  
 COMMIT TRAN    
Return 0  
-- SABBASI  
      
END
GO
GRANT EXECUTE ON [GeoRule_SAVersionUpdateStatus] TO [db_dml]
GO
