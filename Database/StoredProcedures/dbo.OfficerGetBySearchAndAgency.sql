/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OfficerGetBySearchAndAgency]

	@FirstName	NVARCHAR(50),
	@LastName	NVARCHAR(50),
	@RoleID		INT,
	@AgencyID	INT

AS

	SELECT	o.OfficerID, o.FirstName, o.LastName, r.[Role], a.Agency
	FROM	Officer o
		LEFT JOIN User_Role ur ON o.UserID = ur.UserID
		LEFT JOIN [Role] r ON ur.RoleID = r.RoleID
		LEFT JOIN Agency a ON o.AgencyID = a.AgencyID
	WHERE
		(
			(LEN(@FirstName) <= 0)
			OR
			(o.FirstName LIKE '%' + @FirstName + '%')
		)	
		AND
		(
			(LEN(LastName) <= 0)
			OR
			(o.LastName Like '%' + @LastName + '%')
		)	

		AND
		(
			(@RoleID = 0)
			OR
			(ur.RoleID = @RoleID)
		)
		AND
		( 
			(@AgencyID = 0)
			OR
			(a.AgencyID = @AgencyID)
		)
		AND o.Deleted = 0
	ORDER BY a.Agency, r.[Role], o.LastName, o.FirstName
GO
GRANT VIEW DEFINITION ON [OfficerGetBySearchAndAgency] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [OfficerGetBySearchAndAgency] TO [db_dml]
GO
