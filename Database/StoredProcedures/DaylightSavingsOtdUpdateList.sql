/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [DaylightSavingsOtdUpdateList]
AS
BEGIN
	SET NOCOUNT ON;
	select distinct
			a.Agency, 
			so.FirstName + ' ' + so.LastName as 'S.O.',
			o.FirstName + ' ' + o.LastName AS 'Offender',
			s.State,
			ota.TrackerID,
			o.OffenderID
	from Offender o
	inner join Offender_Officer oo on o.OffenderID = oo.OffenderID
	inner join Officer so on oo.OfficerID = so.OfficerID
	inner join Agency a on o.AgencyID = a.AgencyID
	inner join State s on o.HomeStateOrProvinceID = s.StateID
	inner join OffenderTrackerActivation ota on ota.OffenderID = o.OffenderID
	inner join GeoRule_Offender gro on o.OffenderID = gro.OffenderID
	inner join GeoRule gr on gr.GeoRuleID = gro.GeoRuleID
	inner join GeoRuleSchedule grs on grs.GeoRuleScheduleID = gr.GeoRuleScheduleID
	where ota.DeActivateDate is null 
	and o.Deleted = 0
	and s.StateID <> 4    -- exclude Arizona
--and 
--		  grs.AlwaysOn = 0
END


GO
GRANT VIEW DEFINITION ON [DaylightSavingsOtdUpdateList] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [DaylightSavingsOtdUpdateList] TO [db_dml]
GO
