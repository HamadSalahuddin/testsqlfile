/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:28 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [TrackerGetOffenderAssignedInfo]
	@TrackerID	INT
AS

	SELECT	
		ta.TrackerAssignmentTypeID,
		ta.TrackerAssignmentID,
		a.Agency,
		ISNULL(o.FirstName, '')+ ' '+
		ISNULL(o.MiddleName, '')+' '+
		ISNULL(o.LastName, '') AS 'OffenderName',
		ISNULL(so.FirstName, '')+ ' '+
		ISNULL(so.MiddleName, '')+' '+
		ISNULL(so.LastName, '') AS 'officerName',
		o.OffenderID,
		so.officerID,
		a.AgencyID
	FROM	
		Tracker t
		LEFT JOIN Agency a ON t.AgencyID = a.AgencyID
		INNER JOIN TrackerAssignment ta ON ta.TrackerID = t.TrackerID 
			AND ta.TrackerAssignmentID = (SELECT MAX(TrackerAssignmentID) FROM TrackerAssignment ta WHERE ta.TrackerID = t.TrackerID)
		LEFT JOIN Offender o ON (ta.OffenderID = o.OffenderID AND o.Deleted = 0)
		LEFT JOIN Offender_Officer oo ON o.OffenderID = oo.OffenderID
		LEFT JOIN Officer so ON so.OfficerID = oo.OfficerID 
	WHERE	
		t.Deleted = 0 
		AND (@TrackerID = 0 OR t.TrackerID = @TrackerID)
		AND ta.TrackerAssignmentTypeID = 1
GO
GRANT EXECUTE ON [TrackerGetOffenderAssignedInfo] TO [db_dml]
GO
GRANT VIEW DEFINITION ON [TrackerGetOffenderAssignedInfo] TO [db_object_def_viewers]
GO
