/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OTDUploadActions]

@StartTime DateTime, 
@EndTime DateTime

AS
Select
a.Deviceid
,DateADD(mi,-420,a.Starttime) AS StartTime,
dp.Propertyvalue AS SerialNumber,
ag.Agency,
ofi.FirstName+' '+ofi.LastNAme As OfficerName
,ofi.DayPhone
,ofi.MobilePhone
,ofi.EmailAddress1
,o.FirstNAme+' '+o.lastname as OffenderName
From Gateway.DBO.Actions a
JOIN Offendertrackeractivation ota ON ota.trackerid = a.deviceid
JOIN Offender o ON o.Offenderid = ota.Offenderid
JOIN Agency ag ON ag.agencyid = o.agencyid
JOIN Offender_Officer oo ON oo.Offenderid = o.Offenderid
JOIN Officer ofi On ofi.Officerid = oo.Officerid
JOIN Gateway.dbo.devices d ON d.deviceid = a.deviceid
JOIN Gateway.dbo.deviceproperties dp ON dp.deviceid= a.deviceid and dp.propertyid = '8012'

WHERe ota.deactivatedate IS NULL AND DateADD(mi,-420,a.Starttime) Between @StartTime ANd @Endtime
AND a.Actionid = 16

GO
GRANT EXECUTE ON [OTDUploadActions] TO [db_dml]
GO
