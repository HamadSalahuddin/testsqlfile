/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [BillingServiceGetAvailTrackersByAgencyID] @AgencyID INT
AS
--Returns available trackers for an agency.
SET NOCOUNT ON;
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;

SELECT TrackerID
FROM dbo.Tracker t
INNER JOIN dbo.TrackerVersionCompatability tv ON t.TrackerID = tv.CompatabilityID
LEFT OUTER JOIN(SELECT DISTINCT TrackerID 
FROM dbo.OffenderTrackerActivation 
WHERE DeActivateDate IS NULL)  a ON t.TrackerID = a.TrackerID
WHERE a.TrackerID IS NULL AND t.AgencyID = @AgencyID AND tv.VersionID = 5;

GO
GRANT EXECUTE ON [BillingServiceGetAvailTrackersByAgencyID] TO [db_dml]
GO
