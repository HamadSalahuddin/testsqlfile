/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [GetReceivedTimeFromGateway]

	@AlarmID	INT,
	@ReceivedTime DateTime OUTPUT

AS

	SELECT @ReceivedTime= e.ReceivedTime --CONVERT(DATETIME,
--		(
--			DATEADD(ms, (e.EventTime / CAST(10000 AS BIGINT)) % 86400000,
--				DATEADD(day, e.EventTime / CAST(864000000000 AS BIGINT) - 109207, 0)))
--		)

		FROM alarm a
		JOIN Gateway.dbo.Events e ON e.DeviceID = a.TrackerID 
			AND e.EventTime = a.EventTime 
			AND e.EventID = a.EventTypeID
		WHERE a.AlarmID=@AlarmID
select @ReceivedTime




GO
GRANT VIEW DEFINITION ON [GetReceivedTimeFromGateway] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [GetReceivedTimeFromGateway] TO [db_dml]
GO
