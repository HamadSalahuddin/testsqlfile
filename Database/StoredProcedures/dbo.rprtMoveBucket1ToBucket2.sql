/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [rprtMoveBucket1ToBucket2]
AS
BEGIN
	DECLARE @bucket1MaxDate DateTime
	DECLARE @movedRecordCount bigint
	SELECT @bucket1MaxDate = DateADD(minute,-3270,getdate())
	SELECT TOP 5000 * INTO #rprtMoveBucket1ToBucket2 FROM rprtEventsBucket1 WITH (NOLOCK) WHERE EventDateTime<@bucket1MaxDate
	SELECT @movedRecordCount=COUNT(*) FROM #rprtMoveBucket1ToBucket2

	--insert into bucket2	
	INSERT rprtEventsBucket2 
		( EventID,DeviceID,EventTime,EventDateTime,EventParameter,TrackerNumber,EventName,ReceivedTime,OfficerID,
		OffenderID,AgencyID,Latitude,Longitude,OPR,SO,NoteCount,AlarmType,AlarmID,GeoRule,AlarmAssignmentStatusID,
		AlarmAssignmentStatusName,AcceptedBy,ActivateDate,DeActivateDate,GpsValid,GpsValidSatellites,AcceptedDate,
		EventTypeGroupID,EventQueueID,OffenderName,OffenderDeleted,Address  )
	SELECT EventID,DeviceID,EventTime,EventDateTime,EventParameter,TrackerNumber,EventName,ReceivedTime,OfficerID,
		OffenderID,AgencyID,Latitude,Longitude,OPR,SO,NoteCount,AlarmType,AlarmID,GeoRule,AlarmAssignmentStatusID,
		AlarmAssignmentStatusName,AcceptedBy,ActivateDate,DeActivateDate,GpsValid,GpsValidSatellites,AcceptedDate,
		EventTypeGroupID,EventQueueID,OffenderName,OffenderDeleted,Address 
	FROM #rprtMoveBucket1ToBucket2 
--select * from #rprtMoveBucket1ToBucket2

	--delete original records
	DELETE FROM rprtEventsBucket1 WITH (ROWLOCK) WHERE EventPrimaryID in (SELECT EventPrimaryID from #rprtMoveBucket1ToBucket2)
	drop table #rprtMoveBucket1ToBucket2
	SELECT @movedRecordCount
END










GO
GRANT VIEW DEFINITION ON [rprtMoveBucket1ToBucket2] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [rprtMoveBucket1ToBucket2] TO [db_dml]
GO
