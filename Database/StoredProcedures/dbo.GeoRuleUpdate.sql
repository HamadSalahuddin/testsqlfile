/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [GeoRuleUpdate]

	@GeoRuleID					INT,
	@GeoRuleName				NVARCHAR(50),
	@GeoRuleShapeID				INT,	
	@GeoRuleTypeID				INT,
	@GeoRuleReferencePointID	INT,
	@GeoRuleScheduleID			INT,
	@Longitude					FLOAT,
	@Latitude					FLOAT,
	@Radius						INT,
	@Width						FLOAT,
	@Height						FLOAT,
	@Longitudes					VARCHAR(2550),
	@Latitudes					VARCHAR(2550),
	@AlarmInstructions			NVARCHAR(2000),
	@ModifiedByID				INT,
	@AgencyID					INT = NULL

AS

	UPDATE	GeoRule
	SET		GeoRuleName = @GeoRuleName,
			GeoRuleShapeID = @GeoRuleShapeID,
			GeoRuleTypeID = @GeoRuleTypeID,
			GeoRuleReferencePointID = @GeoRuleReferencePointID,
			GeoRuleScheduleID = @GeoRuleScheduleID,
			Longitude = @Longitude,
			Latitude = @Latitude,
			Radius = @Radius,
			Width = @Width,
			Height = @Height,
			Longitudes = @Longitudes,
			Latitudes = @Latitudes,
			AlarmInstructions = @AlarmInstructions,
			ModifiedByID = @ModifiedByID,
			ModifiedDate = GETDATE(),
			STATUSID=2,
			UpdateInProgress=1
	WHERE	GeoRuleID = @GeoRuleID

IF @AgencyID > 0 
BEGIN
	IF NOT EXISTS (SELECT * FROM GeoRule_Agency WHERE GeoRuleID = @GeoRuleID) 
	BEGIN
		INSERT GeoRule_Agency(GeoRuleID, AgencyID)
		VALUES(@GeoRuleID, @AgencyID)
	END
	ELSE 
	BEGIN
		UPDATE GeoRule_Agency
		SET AgencyID = @AgencyID
		WHERE GeoRuleID = @GeoRuleID
	END
END
GO
GRANT VIEW DEFINITION ON [GeoRuleUpdate] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [GeoRuleUpdate] TO [db_dml]
GO
