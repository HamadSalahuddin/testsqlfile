/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [mVictimCreate]
	@CreatedByID int,
	@AgencyID int,
	@OfficerID int,
	@FirstName NVARCHAR(50),
	@MiddleName NVARCHAR(50) = NULL,
	@LastName NVARCHAR(50),
	@BirthDate DATETIME,
	@ProxViolationDistance int,
	@ProxAlertDistance int = NULL,
	@AssociatedOffenderID int = NULL,
	@VictimID int OUTPUT

AS
BEGIN
SET NOCOUNT ON;
	
INSERT INTO [dbo].[Offender] (
	[CreatedDate],
	[CreatedByID],
	[AgencyID],
	[FirstName],
	[MiddleName],
	[LastName],
	[BirthDate],
	[VictimProxViolationDistance],
	[VictimProxAlertDistance],
	[VictimAssociatedOffenderID],
	[Victim],
	[Deleted]
) 
VALUES 
(
	GETDATE(),
	@CreatedByID,
	@AgencyID,
	@FirstName,
	@MiddleName,
	@LastName,
	@BirthDate,
	@ProxViolationDistance,
	@ProxAlertDistance,
	@AssociatedOffenderID,
	1,
	0
)

SET @VictimID = SCOPE_IDENTITY()

IF @OfficerID IS NOT NULL
BEGIN

INSERT INTO [dbo].Offender_Officer (
	[OffenderID],
	[OfficerID]
)
VALUES
(	
	@VictimID,
	@OfficerID
)

END

END

GO
GRANT EXECUTE ON [mVictimCreate] TO [db_dml]
GO
