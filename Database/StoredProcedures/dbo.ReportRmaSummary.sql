/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
--DECLARE @Offset int
CREATE PROCEDURE [ReportRmaSummary]
@Offset int

AS
Select 
DateADD(mi,-360,tr.CreatedDate) As 'DateAdded'
,opr.FirstName+' '+opr.LastName AS 'Added By'
,dp.Propertyvalue AS 'Device Serial'
,dp1.Propertyvalue AS 'ICCID'
,nop.[name] AS 'Carrier'
,DateADD(mi,-360,DateADD(mi,-@Offset,GetDate())) As 'Start'
,DATEADD(mi,-360,GETDATE()) AS 'End'

From dbo.TrackerRma tr
LEFt JOIN Gateway.dbo.deviceproperties dp ON dp.deviceid = tr.Trackerid AND dp.propertyid = '8012'
LEFt JOIN Gateway.dbo.deviceproperties dp1 ON dp1.deviceid = tr.Trackerid AND dp1.propertyid = '8204'
JOIN Operator opr on opr.userid = tr.CreatedByid
LEFT JOIN Operator opr1 ON opr1.userid = tr.Removedbyid
JOIN Gateway.dbo.DeviceProperties dp3 ON tr.Trackerid = dp3.DeviceID AND dp3.PropertyID = '8202'
LEFT JOIN Gateway.dbo.NetworkOperators nop ON nop.MCC+nop.MNC = LEFT(dp3.Propertyvalue,6)
Where DateADD(mi,-360,tr.CreatedDate) > DateADD(mi,-@Offset,DateADD(mi,-360,GetDate())) AND tr.RemovedDate is NULL
Order BY DateADD(mi,-360,tr.CreatedDate)





GO
GRANT EXECUTE ON [ReportRmaSummary] TO [db_dml]
GO
