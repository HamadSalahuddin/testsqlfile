/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OffenderGetTrackerID]

	@TrackerID	INT OUTPUT,
	@OffenderID	INT

AS

	SELECT	
		@TrackerID = 
		CASE
			WHEN ta.TrackerAssignmentTypeID = 1 THEN ta.TrackerID
			ELSE 0
		END 
	FROM	
		Offender o
		LEFT JOIN TrackerAssignment ta ON ta.OffenderID = o.OffenderID 
			AND ta.TrackerAssignmentID = (SELECT MAX(TrackerAssignmentID) FROM TrackerAssignment ta WHERE ta.OffenderID = o.OffenderID)
	WHERE	
		o.OffenderID = @OffenderID
GO
GRANT EXECUTE ON [OffenderGetTrackerID] TO [db_dml]
GO
GRANT VIEW DEFINITION ON [OffenderGetTrackerID] TO [db_object_def_viewers]
GO
