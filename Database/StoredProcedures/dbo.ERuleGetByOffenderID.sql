/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [ERuleGetByOffenderID]
@OffenderID INT    
    
AS    
    
 SET NOCOUNT ON    
    
  SELECT er.ID as 'ERuleID',er.[Name],        
            r.UploadStatusID,        
            g.GeoRuleStatusName as 'StatusName',        
     b.id as 'BeaconID', b.BeaconName, b.Identifier,r.updateinprogress as 'UpdateInProgress',      
 case when r.FileID is null then 0 else r.FileID end as 'FileID'      ,bo.OffenderID    
 FROM dbo.ERule er        
     
 inner join [Rule] r ON r.ID=er.RuleID        
    inner join GeoRuleStatus g ON g.GeoRuleStatusID=r.UploadStatusID        
 inner join Beacon b ON b.ID=er.BeaconID        
 inner join BeaconOffender bo ON bo.BeaconID=b.ID       
 inner join Etracker et on er.AssignedEtrackerID = et.EtrackerID         
    inner join Tracker t on t.TrackerUniqueID = et.TrackerID         
 --inner join offender o on o.offenderid = bo.OffenderID and t.TrackerID  =o.TrackerID      
      
    WHERE   bo.OffenderID=@OffenderID ORDER BY b.BeaconName DESC       

	

GO
GRANT EXECUTE ON [ERuleGetByOffenderID] TO [db_dml]
GO
