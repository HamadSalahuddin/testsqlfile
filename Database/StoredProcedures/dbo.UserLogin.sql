/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:28 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [UserLogin]

	@UserID			INT OUTPUT,
	@UserTypeID		INT OUTPUT,
	@RoleID			INT OUTPUT,
	@UserName		NVARCHAR(25),
	@UserPassword	NVARCHAR(50)
	
AS

	SELECT	@UserID = u.UserID,
			@UserTypeID = u.UserTypeID,
			@RoleID = ur.RoleID
	FROM	[User] u
	INNER JOIN User_Role ur ON u.UserID = ur.UserID
	WHERE	UserName = @UserName AND
			UserPassword = @UserPassword AND
			Deleted = 0

	IF @@ROWCOUNT > 0
	BEGIN
		UPDATE	[User]
		SET		LastLoginDate = GETDATE()
		WHERE	UserID = @UserID
	END
GO
GRANT VIEW DEFINITION ON [UserLogin] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [UserLogin] TO [db_dml]
GO
