/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OffenderDemographics]
AS
BEGIN
	SET NOCOUNT ON;

SELECT TOP 1
	(SELECT Count(*) FROM Offender) AS 'Total Offenders',
	(SELECT Count(*) FROM Offender WHERE Deleted = 0) AS 'Active Offenders',
	(SELECT Count(*) FROM Offender WHERE Deleted = 1) AS 'Archived Offenders',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 1 AND o.Deleted = 0) AS 'Misdemeanor High',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 2 AND o.Deleted = 0) AS 'Misdemeanor Medium',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 3 AND o.Deleted = 0) AS 'Misdemeanor Low',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 4 AND o.Deleted = 0) AS 'Felony High',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 5 AND o.Deleted = 0) AS 'Felony Medium',
	(SELECT Count(*) FROM Offender o WHERE o.OffenseTypeID = 6 AND o.Deleted = 0) AS 'Felony Low',
	(SELECT Count(*) FROM Offender o WHERE (o.OffenseTypeID NOT IN (1,2,3,4,5,6) or OffenseTypeID is null) AND o.Deleted = 0) AS 'Offense Type Unspecified',
	(SELECT Count(*) FROM Offender o WHERE o.RiskLevelID = 4 AND o.Deleted = 0) AS 'Watch Risk',
	(SELECT Count(*) FROM Offender o WHERE o.RiskLevelID = 1 AND o.Deleted = 0) AS 'High Risk',
	(SELECT Count(*) FROM Offender o WHERE o.RiskLevelID = 2 AND o.Deleted = 0) AS 'Medium Risk',
	(SELECT Count(*) FROM Offender o WHERE o.RiskLevelID = 3 AND o.Deleted = 0) AS 'Low Risk',
	(SELECT Count(*) FROM Offender o WHERE (o.RiskLevelID NOT IN (1,2,3,4) or o.RiskLevelID is null) AND o.Deleted = 0) AS 'Unspecified Risk',
	(SELECT Count(*) FROM Offender o WHERE DateDiff(yyyy,o.BirthDate,GetDate())  < 18 AND o.Deleted = 0) AS 'Age < 18',
	(SELECT Count(*) FROM Offender o WHERE DateDiff(yyyy,o.BirthDate,GetDate())  >= 18 AND DateDiff(yyyy,o.BirthDate,GetDate())  <= 21 AND o.Deleted = 0) AS 'Age 18 - 21',
	(SELECT Count(*) FROM Offender o WHERE DateDiff(yyyy,o.BirthDate,GetDate())  > 21 AND DateDiff(yyyy,o.BirthDate,GetDate())  <= 29 AND o.Deleted = 0) AS 'Age 22 - 29',
	(SELECT Count(*) FROM Offender o WHERE DateDiff(yyyy,o.BirthDate,GetDate())  > 29 AND DateDiff(yyyy,o.BirthDate,GetDate())  <= 39 AND o.Deleted = 0) AS 'Age 30 - 39',
	(SELECT Count(*) FROM Offender o WHERE DateDiff(yyyy,o.BirthDate,GetDate())  > 39 AND o.Deleted = 0) AS 'Age 40+',
	(SELECT Count(*) FROM Offender o WHERE (o.BirthDate IS NULL) AND o.Deleted = 0) AS 'Unspecified Age'
FROM Offender
END



GO
GRANT EXECUTE ON [OffenderDemographics] TO [db_dml]
GO
GRANT VIEW DEFINITION ON [OffenderDemographics] TO [db_object_def_viewers]
GO
