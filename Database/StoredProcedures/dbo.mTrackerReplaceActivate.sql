/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [mTrackerReplaceActivate]

	@TrackerActivationID INT OUTPUT,
	@TrackerID INT,
	@OffenderID INT,
	@OfficerID INT,
	@ModifiedByID INT,
	@ActivateDate DATETIME OUTPUT,
	@IsDemo BIT OUTPUT,
	@BillableID INT OUTPUT

AS

SET @ActivateDate = GETDATE()

SELECT TOP 1
	@IsDemo = IsDemo,
	@BillableID = BillableID
FROM
	Tracker
WHERE
	TrackerID = @TrackerID AND Deleted = 0 ORDER BY CreatedDate DESC

IF (
	SELECT COUNT(ActivateDate)
	FROM OffenderTrackerActivation
	WHERE TrackerID = @TrackerID AND OffenderID = @OffenderID AND OfficerID = @OfficerID AND DeactivateDate IS NULL
	) = 0
BEGIN

INSERT INTO OffenderTrackerActivation
	(TrackerID, OffenderID, OfficerID, ActivateDate, ModifiedByID, IsDemo, BillableID)
VALUES
	(@TrackerID, @OffenderID, @OfficerID, @ActivateDate, @ModifiedByID, @IsDemo, @BillableID)

SET @TrackerActivationID = SCOPE_IDENTITY()


END









GO
GRANT EXECUTE ON [mTrackerReplaceActivate] TO [db_dml]
GO
