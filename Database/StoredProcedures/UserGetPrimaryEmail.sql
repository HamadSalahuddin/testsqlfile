/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:28 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [UserGetPrimaryEmail]
	@UserID			INT OUTPUT,
	@PrimaryEmail	NVARCHAR(50) OUTPUT,
	@UserName		NVARCHAR(25) 
	
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @Operator INT, @Officer INT, @Distributor INT;
	SET @Operator=1;
	SET @Officer=2;
	SET @Distributor=3;

    -- Insert statements for procedure here
	SELECT	@UserID = u.UserID,
			@PrimaryEmail =
				CASE u.UserTypeID
					WHEN @Operator THEN  op.EmailAddress1
					WHEN @Officer THEN ofi.EmailAddress1
					WHEN @Distributor THEN dib.EmailAddress
				END	
	FROM    [User] u
	LEFT JOIN Operator op ON u.UserID=op.UserID
	LEFT JOIN Officer ofi ON u.UserID=ofi.UserID
	LEFT JOIN DistributorEmployee dib ON u.UserID=dib.UserID
	WHERE u.UserName=@UserName;
END
GO
GRANT VIEW DEFINITION ON [UserGetPrimaryEmail] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [UserGetPrimaryEmail] TO [db_dml]
GO
