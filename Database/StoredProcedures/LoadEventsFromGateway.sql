/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [LoadEventsFromGateway]
	@EventTime		BIGINT,
	@DeviceID		bigint,
	@EventID		int,
	@RecordLimit	int
	
AS

	SELECT	TOP (@RecordLimit) ev.DeviceID,
		ev.EventTime,
		ev.EventID,
		ev.EventParameter,
		ev.GpsValid,
		ev.GpsValidSatellites,
		ev.ReceivedTime,
		ev.TransmittedTime,
		ev.Latitude,
		ev.Longitude,
		et.longname as EventName,
		ge.AlarmType,
		ge.Enabled
--		ota.TrackerActivationID,
--		ota.OffenderID AS 'ActivationOffenderID',
--		ota.OfficerID AS 'ActivationOfficerID',
--		ota.ActivateDate AS 'ActivationActiveDate',
--		ota.IsDemo AS 'ActivationIsDemo',
--		ota.BillableID AS 'ActivationBillableID',
--		ota.ModifiedByID AS 'ActivationModifiedByID'

	FROM	
		Gateway.dbo.Events ev 
--		Gateway.dbo.EventsAculis ev 
	LEFT JOIN Gateway.dbo.EventTypes ge ON ge.EventID = ev.EventID	
	LEFT JOIN EventType et ON et.EventTypeID = ev.EventID
--	INNER JOIN OffenderTrackerActivation ota ON ota.TrackerID=ev.DeviceID AND
--	DeActivateDate IS NULL 
	
	WHERE 
		ev.EventTime >= @EventTime 
		AND NOT( ev.EventTime = @EventTime AND ev.DeviceID = @DeviceID AND ev.EventID = @EventID)
	ORDER BY ev.EventTime
GO
GRANT VIEW DEFINITION ON [LoadEventsFromGateway] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [LoadEventsFromGateway] TO [db_dml]
GO
