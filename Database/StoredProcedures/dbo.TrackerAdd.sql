/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:28 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [TrackerAdd]

	@TrackerID		INT,
	@TrackerNumber	VARCHAR(32),
	@AgencyID		INT,
	@CreatedByID	INT,
	@IsDemo			bit,
	@TrackerUniqueID INT = NULL OUTPUT

AS
	
DECLARE @RmaID int
SET @RmaID = (
	SELECT TOP 1 RmaID 
	FROM Tracker 
	WHERE 
		TrackerID = @TrackerID 
		AND TrackerNumber = @TrackerNumber 
		AND CreatedDate = (
			SELECT MAX(CreatedDate) 
			FROM Tracker
			WHERE TrackerNumber = @TrackerNumber AND TrackerNumber = @TrackerNumber
		)
)

	INSERT INTO Tracker
	(TrackerID, TrackerNumber, AgencyID, CreatedByID, RmaID, isDemo)
	VALUES
	(@TrackerID, @TrackerNumber, @AgencyID, @CreatedByID, @RmaID, @IsDemo)

	SET @TrackerUniqueID = @@IDENTITY
GO
GRANT VIEW DEFINITION ON [TrackerAdd] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [TrackerAdd] TO [db_dml]
GO
