/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [eArrestGeteRulesByTrackerID]
@TrackerID			INT,
@BeaconID			INT
AS



Select er.[Name] as 'eRule Name',a.ID as 'AddressID',r.ID as 'RuleID', b.Identifier as 'SerialNumber',
r.UploadStatusID, e.ETrackerID,r.CreatedByID, g.Longitude, g.Latitude, bst.Value as 'Threshold', bst.GatewayID,
s.ID as 'ScheduleID', s.StartDateTime,s.EndDateTime, s.AlwaysOn, t.TrackerNumber
from Etracker e 
INNER JOIN ERule er ON er.AssignedETrackerID=e.ETrackerID 
INNER JOIN Beacon b ON b.ID=er.BeaconID
INNER JOIN Tracker t ON t.TrackerUniqueID = e.TrackerID
INNER JOIN Offender o ON o.TrackerID = t.TrackerID
INNER JOIN OffenderBeaconThreshold ob ON ob.OffenderID = o.OffenderID
INNER JOIN refBeaconSignalThreshold bst ON bst.ID = ob.BeaconThresholdID
INNER JOIN Address  a ON b.AddressID=a.ID
INNER JOIN GPSLocation g ON g.AddressID = a.ID
INNER JOIN [Rule] r ON r.ID=er.RuleID 
INNER JOIN Schedule s ON s.RuleID=r.ID 
where e.TrackerID=@TrackerID AND er.BeaconID = @BeaconID
GO
GRANT EXECUTE ON [eArrestGeteRulesByTrackerID] TO [db_dml]
GO
