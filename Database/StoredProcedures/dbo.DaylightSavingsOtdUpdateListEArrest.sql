/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [DaylightSavingsOtdUpdateListEArrest]
AS
BEGIN
	SET NOCOUNT ON;

	select distinct
		a.Agency,
		so.FirstName + ' ' + so.LastName as 'S.O.',
		o.FirstName + ' ' + o.LastName AS 'Offender',
		s.State,
		ota.TrackerID,
		o.OffenderID
	from Offender o (nolock)
	inner join Offender_Officer oo (nolock) on o.OffenderID = oo.OffenderID
	inner join Officer so (nolock) on oo.OfficerID = so.OfficerID
	inner join Agency a (nolock) on o.AgencyID = a.AgencyID
	inner join State s (nolock) on o.HomeStateOrProvinceID = s.StateID
	inner join OffenderTrackerActivation ota (nolock) on ota.OffenderID = o.OffenderID
--	inner join ERule er on er.AssignedETrackerID = ota.TrackerID
	inner join BeaconOffender bo (nolock) on o.offenderid = bo.offenderid
	inner join ERule er (nolock) on er.beaconid = bo.beaconid
	inner join [Rule] r (nolock) on r.ID = er.RuleID
	inner join Schedule sch (nolock) on r.ID = sch.RuleID
	inner join TrackerAssignment ta (nolock) on ta.offenderID = o.offenderid and ta.trackerid = ota.Trackerid
	where  ota.DeActivateDate is null 
		and o.Deleted = 0 
		and sch.AlwaysOn = 0
		and s.StateID <> 4
END

GO
GRANT EXECUTE ON [DaylightSavingsOtdUpdateListEArrest] TO [db_dml]
GO
