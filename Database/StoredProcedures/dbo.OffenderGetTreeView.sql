/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OffenderGetTreeView]

	@AgencyID	INT,
	@OfficerID	INT,
	@RoleID		INT

AS

	IF @RoleID = 2
	BEGIN
		SELECT	OffenderID, 
				'Offender List' AS 'OffenderList',
				ISNULL(LastName + ', ', '') + ISNULL(FirstName, '') AS 'OffenderName'
		FROM	Offender
		WHERE	AgencyID = @AgencyID
        AND Deleted = 0
		ORDER BY LastName, FirstName		
	END
	ELSE
	BEGIN
				SELECT	o.OffenderID, 
						'Offender List' AS 'OffenderList',
						ISNULL(o.LastName + ', ', '') + ISNULL(o.FirstName, '') AS 'OffenderName'
				FROM	Offender o
				INNER JOIN Offender_Officer oo ON o.OffenderID = oo.OffenderID
				WHERE	(
							(@AgencyID = 0)
							 or
							(o.AgencyID = @AgencyID)
						) AND
						(
							(@OfficerID = 0)
							or
							(oo.OfficerID = @OfficerID)
						)
				AND Deleted = 0
				ORDER BY LastName, FirstName
	END
GO
GRANT VIEW DEFINITION ON [OffenderGetTreeView] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [OffenderGetTreeView] TO [db_dml]
GO
