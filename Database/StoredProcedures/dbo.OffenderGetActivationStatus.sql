/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OffenderGetActivationStatus]

	@OffenderID	INT

AS

SELECT 
	ota.ActivateDate,
	ota.DeActivateDate
FROM 
	dbo.OffenderTrackerActivation ota
	INNER JOIN Offender_Officer oo ON oo.OffenderID = ota.OffenderID
	INNER JOIN Offender o ON o.OffenderID = oo.OffenderID
	LEFT JOIN TrackerAssignment ta ON ta.OffenderID = o.OffenderID 
		AND ta.TrackerAssignmentID = (SELECT MAX(TrackerAssignmentID) FROM TrackerAssignment ta WHERE ta.OffenderID = o.OffenderID)
WHERE 
	ota.OffenderID = @OffenderID
	AND ota.TrackerID = ta.TrackerID
	AND ta.TrackerAssignmentTypeID = 1
	AND ota.DeActivateDate IS NULL
GO
GRANT EXECUTE ON [OffenderGetActivationStatus] TO [db_dml]
GO
GRANT VIEW DEFINITION ON [OffenderGetActivationStatus] TO [db_object_def_viewers]
GO
