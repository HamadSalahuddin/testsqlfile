/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [OffenderTrackerDeActivate]
        
        @TrackerID              INT,
        @OffenderID             INT,
        @OfficerID              INT,
        @ModifiedByID   INT,
        @DeactivateDate DATETIME, -- DEPRECATED - DESPERATE TIMES CALL FOR DESPERATE MEASURES
        @TrackerDeactivationReasonID INT,
        @ReasonText     VARCHAR(100),
        @TrackerActivationID INT = NULL OUTPUT

AS

SELECT  @TrackerActivationID = TrackerActivationID
FROM    OffenderTrackerActivation
WHERE   TrackerID = @TrackerID
                AND OffenderID = @OffenderID
                AND OfficerID = @OfficerID
                AND DeActivateDate IS NULL

UPDATE  OffenderTrackerActivation
SET             DeActivateDate = GETDATE(),
                ModifiedByID = @ModifiedByID, 
                TrackerDeactivationReasonID = @TrackerDeactivationReasonID, 
                ReasonText = @ReasonText
WHERE   TrackerID = @TrackerID
                AND OffenderID = @OffenderID
                AND OfficerID = @OfficerID
                AND DeActivateDate IS NULL
GO
GRANT VIEW DEFINITION ON [OffenderTrackerDeActivate] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [OffenderTrackerDeActivate] TO [db_dml]
GO
