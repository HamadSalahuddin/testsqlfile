/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [GeoRuleGetAllByOffenderID2]

	@OffenderID	INT

AS
SELECT g.GeoRuleID, 
       g.GeoRuleName, 
       g.GeoRuleShapeID, 
       g.GeoRuleTypeID, 
       g.StatusID, 
       g.UpdateInProgress,
	   ROUND(g.Longitude,5) AS 'Longitude',
	   ROUND(g.Latitude,5) AS 'Latitude', 
	   g.Radius, 
	   g.Width, 
	   g.Height, 
	   g.Longitudes,
	   g.Latitudes,
	   s.AlwaysOn, 
	   s.StartTime, 
	   s.EndTime, 
	   s.Sunday, 
	   s.Monday, 
	   s.Tuesday,
	   s.Wednesday, 
	   s.Thursday, 
	   s.Friday, 
	   s.Saturday, 
	   g.AlarmInstructions,
	   r.Street, 
	   r.City, 
	   [state].Abbreviation,
	   r.PostalCode,
	   c.country,
	   f.ZoneID
FROM GeoRule g WITH (NOLOCK)
  INNER JOIN GeoRule_Offender f ON g.GeoRuleID = f.GeoRuleID
  LEFT JOIN GeoRuleSchedule s ON g.GeoRuleScheduleID = s.GeoRuleScheduleID
  LEft Join GEoRuleReferencePoint r on g.GeoRuleReferencePointId = r.GeoRuleReferencePointId
  left join dbo.[State] on [state].stateID = r.stateid
  left join country c on c.countryid = r.countryID 
WHERE f.OffenderID = @OffenderID 
  AND g.UpdateInProgress = 1
ORDER BY g.GeoRuleName

GO
GRANT EXECUTE ON [GeoRuleGetAllByOffenderID2] TO [db_dml]
GO
