/*
Script generated by Aqua Data Studio 8.0.2 on Jan-15-2010 01:50:27 PM
Database: TrackerPal
Schema: <All Schemas>
Objects: PROCEDURE
*/
CREATE PROCEDURE [GeoRuleGetByID]

	@GeoRuleID	INT

AS
	SELECT	g.GeoRuleID, g.GeoRuleName, g.GeoRuleShapeID, g.GeoRuleTypeID, 
			g.GeoRuleReferencePointID, g.GeoRuleScheduleID, 
			ROUND(g.Longitude,5) AS 'Longitude',ROUND(g.Latitude,5) AS 'Latitude', g.Radius, g.Width, g.Height, 
			g.Longitudes, g.Latitudes, g.AlarmInstructions,
			ISNULL(r.Street, '') AS 'Street',
			ISNULL(r.City, '') AS 'City',
			ISNULL(r.StateID, 1) AS 'StateID', -- 1 = "Choose"
			ISNULL(r.PostalCode, '') AS 'PostalCode',
			ISNULL(r.CountryID, 215) AS 'CountryID', -- 215 = USA
			ISNULL(ROUND(r.Longitude,5), 0) AS 'ReferencePointLongitude',
			ISNULL(ROUND(r.Latitude,5),0) AS 'ReferencePointLatitude',
			ISNULL(STR(s.AlwaysOn, 1), 1) AS 'AlwaysOn',
			ISNULL(s.StartTime, 0) AS 'StartTime',
			ISNULL(s.EndTime, 0) AS 'EndTime',
			ISNULL(s.Sunday, 0) AS 'Sunday',
			ISNULL(s.Monday, 0) AS 'Monday',
			ISNULL(s.Tuesday, 0) AS 'Tuesday',
			ISNULL(s.Wednesday, 0) AS 'Wednesday',
			ISNULL(s.Thursday, 0) AS 'Thursday',
			ISNULL(s.Friday, 0) AS 'Friday',
			ISNULL(s.Saturday, 0) AS 'Saturday',
			ga.AgencyID,
			r.Street , r.City, state.Abbreviation ,r.PostalCode ,c.country
	FROM	GeoRule g (NOLOCK)
	LEFT JOIN GeoRuleReferencePoint r (NOLOCK) ON g.GeoRuleReferencePointID = r.GeoRuleReferencePointID 
	LEFT JOIN GeoRuleSchedule s  (NOLOCK) ON g.GeoRuleScheduleID = s.GeoRuleScheduleID 
	Left Join GeoRule_Agency ga (NOLOCK) ON ga.GeoRuleID = g.GeoRuleID 
	left join State on state.stateID= r.stateid
	left join country c on c.countryid = r.countryID 	

	WHERE	g.GeoRuleID = @GeoRuleID AND
			Deleted = 0
GO
GRANT VIEW DEFINITION ON [GeoRuleGetByID] TO [db_object_def_viewers]
GO
GRANT EXECUTE ON [GeoRuleGetByID] TO [db_dml]
GO
